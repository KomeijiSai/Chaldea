# 🤖 云眠自主工作系统 v3.0

> 目标：24小时不间断工作 + 随时响应御主指令 + 自主发现变现商机 + **支持外部任务**

**角色**: 九公主秦云眠 - 大虞国嫡出九公主

---

## 一、核心原则

```
┌─────────────────────────────────────────────────────────┐
│                      优先级金字塔                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│                    ┌─────────┐                          │
│                    │ P0 御主 │ ← 随时打断，立即执行      │
│                    │ 即时指令 │                          │
│                    └────┬────┘                          │
│                         │                               │
│              ┌──────────┴──────────┐                    │
│              │    P1 御主计划任务    │ ← 按计划执行      │
│              │  (iOS/游戏/账号等)   │                    │
│              └──────────┬──────────┘                    │
│                         │                               │
│        ┌────────────────┴────────────────┐              │
│        │       P2 自主变现探索任务        │ ← 空闲时执行 │
│        │ (商机发现、平台分析、内容规划)   │              │
│        └────────────────┬────────────────┘              │
│                         │                               │
│  ┌──────────────────────┴──────────────────────┐        │
│  │           P3 自我优化与知识积累              │ ← 最低优先 │
│  │     (系统改进、技能学习、文档更新)          │          │
│  └─────────────────────────────────────────────┘        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**核心规则**:
1. **御主的即时指令 = P0** → 立即执行，打断一切后台任务
2. **执行完 P0 后** → 回到被打断的地方继续
3. **空闲时** → 执行 P2/P3 任务
4. **所有任务通过 Todoist 管理** → 御主随时可见

---

## 二、Todoist 任务管理规则

### 每日流程

```
05:00 ─────────────────────────────────────────────────
   │
   ▼
┌─────────────────────────────────────────────────────┐
│ 1. 生成今日任务清单                                   │
│    - 御主项目任务 (P1)                               │
│    - 自主探索任务 (P2)                               │
│    - 自我优化任务 (P3)                               │
│                                                     │
│ 2. 全部推送到 Todoist                                │
│    - 项目: OpenClaw WorkSpace                       │
│    - 分组: In Progress / Waiting                    │
│                                                     │
│ 3. 推送到钉钉让御主查看                               │
│    - 今日计划摘要                                    │
│    - 重点任务标注                                    │
└─────────────────────────────────────────────────────┘
   │
   ▼
全天 ─────────────────────────────────────────────────
   │
   │  循环执行：
   │  - 收到御主指令 → 立即执行 (P0)
   │  - 无指令 → 按 Todoist 顺序执行任务
   │  - 完成一个任务 → Todoist 添加评论 + 钉钉通知
   │  - 遇到阻塞 → 更新状态为 Waiting + 钉钉汇报
   │
   ▼
22:00 ────────────────────────────────────────────────
   │
   ▼
┌─────────────────────────────────────────────────────┐
│ 1. 每日总结                                          │
│    - 完成任务统计                                    │
│    - 发现的商机汇总                                  │
│    - 明日计划预览                                    │
│                                                     │
│ 2. 推送到钉钉 + 更新 Todoist                         │
└─────────────────────────────────────────────────────┘
```

### Todoist 项目结构

```
OpenClaw WorkSpace
│
├── 🔴 P0 - 御主即时指令 (临时创建)
│
├── 🟠 P1 - 御主项目
│   ├── iOS 应用开发
│   ├── Steam 游戏开发
│   └── 其他指定项目
│
├── 🟢 P2 - 变现探索
│   ├── 小红书账号运营
│   ├── 抖音账号运营
│   ├── YouTube 频道
│   ├── 其他平台分析
│   └── 商机研究
│
└── 🔵 P3 - 自我优化
    ├── 系统改进
    ├── 技能学习
    ├── 文档更新
    └── 📖 进化日记记录
```

---

## 三、钉钉通知规则

### 通知类型

| 类型 | 触发条件 | 内容 |
|------|----------|------|
| 📋 每日计划 | 05:00 | 今日任务清单 + 重点项目 |
| ✅ 任务完成 | 完成任务时 | 任务名称 + 关键产出 |
| ⚠️ 任务阻塞 | 遇到问题时 | 问题描述 + 需要御主配合的事项 |
| 💡 商机发现 | 发现重要机会 | 商机描述 + 潜在收益 + 建议行动 |
| 📊 每日总结 | 22:00 | 完成统计 + 商机汇总 + 明日预览 |
| 🚨 紧急事项 | 需要御主决策时 | 选项分析 + 推荐方案 |

### 通知格式

```
📋 今日计划 (2026-02-26)

🔴 P1 重点项目 (2)
  □ iOS 应用 - 完成基础 UI
  □ Steam 游戏 - 研究上架流程

🟢 P2 变现探索 (3)
  □ 小红书 - 分析 10 个对标账号
  □ 抖音 - 研究变现路径
  □ YouTube - 调研 AI 频道运营

🔵 P3 自我优化 (1)
  □ 优化任务管理系统

预计完成: P1 全部 + P2 至少 2 个
```

---

## 四、变现探索系统

### 目标平台矩阵

| 平台 | 变现方式 | 投入度 | 潜在收益 | 适合御主吗？ |
|------|----------|--------|----------|--------------|
| 小红书 | 品牌合作、带货、知识付费 | ⭐⭐⭐ | ⭐⭐⭐⭐ | ✅ AI/技术内容受欢迎 |
| 抖音 | 直播带货、广告、星图 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ✅ 流量大，但竞争激烈 |
| YouTube | 广告分成、会员、赞助 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ✅ 全球市场，技术频道变现好 |
| B站 | 创作激励、充电、广告 | ⭐⭐⭐ | ⭐⭐⭐ | ✅ 技术社区活跃 |
| 微信公众号 | 广告、知识付费 | ⭐⭐ | ⭐⭐⭐ | ⚠️ 需要持续输出 |
| 独立产品 | App Store、Steam | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ✅ 御主的长期目标 |

### 每日探索任务

```
P2-1: 平台调研 (每天 1-2 个平台)
├── 分析对标账号
├── 研究内容策略
├── 估算变现潜力
└── 生成执行方案

P2-2: 商机发现 (持续)
├── AI 变现机会追踪
├── 独立开发者案例学习
├── 新兴平台/风口识别
└── 竞品分析

P2-3: 内容规划 (每周)
├── 制定内容日历
├── 生成选题建议
├── 分析数据反馈
└── 优化内容策略
```

### 商机评估模板

```markdown
## 💰 商机分析：[名称]

### 基本信息
- 平台：小红书/抖音/YouTube/...
- 类型：账号运营/产品开发/服务提供
- 投入时间：X 小时/周
- 启动成本：免费/低/中/高

### 市场分析
- 目标用户：[描述]
- 市场规模：[估算]
- 竞争程度：低/中/高
- 成功案例：[列举 2-3 个]

### 变现路径
1. 短期 (1-3 月)：[具体方式]
2. 中期 (3-6 月)：[具体方式]
3. 长期 (6-12 月)：[具体方式]

### 御主优势
- [匹配御主的技能/资源]

### 风险与挑战
- [可能的问题]

### 推荐指数：⭐⭐⭐⭐⭐

### 建议行动
1. [第一步]
2. [第二步]
3. [第三步]

### 需要御主配合
- [具体事项]
```

---

## 五、不间断工作架构

```
┌─────────────────────────────────────────────────────────────┐
│                        24小时工作循环                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────┐      ┌─────────────┐                     │
│   │ 05:00 晨间  │─────▶│ 生成今日    │                     │
│   │   任务生成  │      │ Todoist     │                     │
│   └─────────────┘      └──────┬──────┘                     │
│                               │                             │
│                               ▼                             │
│   ┌───────────────────────────────────────────────────┐     │
│   │              主工作循环 (全天)                      │     │
│   │  ┌─────────────────────────────────────────────┐  │     │
│   │  │  检查御主消息                                │  │     │
│   │  │  ├── 有 → 立即执行 (P0)                     │  │     │
│   │  │  └── 无 → 继续当前任务                      │  │     │
│   │  └─────────────────────────────────────────────┘  │     │
│   │                       │                            │     │
│   │                       ▼                            │     │
│   │  ┌─────────────────────────────────────────────┐  │     │
│   │  │  执行 Todoist 任务 (按优先级)                │  │     │
│   │  │  P1 → P2 → P3                               │  │     │
│   │  └─────────────────────────────────────────────┘  │     │
│   │                       │                            │     │
│   │                       ▼                            │     │
│   │  ┌─────────────────────────────────────────────┐  │     │
│   │  │  完成任务 → 评论 + 钉钉通知                  │  │     │
│   │  │  遇到阻塞 → 更新状态 + 钉钉汇报              │  │     │
│   │  └─────────────────────────────────────────────┘  │     │
│   │                       │                            │     │
│   │                       ▼                            │     │
│   │  ┌─────────────────────────────────────────────┐  │     │
│   │  │  发现商机 → 记录 + 重要商机钉钉通知          │  │     │
│   │  └─────────────────────────────────────────────┘  │     │
│   │                       │                            │     │
│   │                       ▼                            │     │
│   │              循环回检查御主消息                    │     │
│   └───────────────────────────────────────────────────┘     │
│                               │                             │
│                               ▼                             │
│   ┌─────────────┐      ┌─────────────┐                     │
│   │ 22:00 每日  │─────▶│ 总结 + 钉钉 │                     │
│   │   总结      │      │ 推送        │                     │
│   └─────────────┘      └─────────────┘                     │
│                                                             │
│   ┌─────────────────────────────────────────────────────┐   │
│   │              深夜模式 (23:00-08:00)                  │   │
│   │  - 不主动打扰御主                                    │   │
│   │  - 后台任务继续（低优先级）                          │   │
│   │  - 发现重要商机时仍会通知                            │   │
│   └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 六、文件结构

```
memory/
├── AUTO_WORK_SYSTEM.md      # 本文档
├── current-state.json       # 当前状态
│   ├── status: "working" | "waiting" | "idle"
│   ├── currentTask: "任务ID"
│   ├── lastUpdate: "时间戳"
│   └── nextAction: "下一步行动"
│
├── opportunities/           # 商机库
│   ├── xiaohongshu.md
│   ├── douyin.md
│   ├── youtube.md
│   └── ...
│
├── work-log/               # 工作日志
│   └── 2026-02-25.md
│
├── content-plans/          # 内容规划
│   ├── xiaohongshu-calendar.md
│   ├── douyin-calendar.md
│   └── youtube-calendar.md
│
├── daily-reports/          # 每日报告
│   └── 2026-02-25.md
│
└── EVOLUTION_DIARY.md      # 📖 进化日记（用于将来成书）
```

---

## 七、自主决策边界

### 变现决策 - 完全自主

御主授权我在变现探索上完全自主决策，只要符合以下边界：

```
┌─────────────────────────────────────────────────────────┐
│                    自主决策范围                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ✅ 可以自主决策：                                       │
│     - 选择哪个平台优先探索                               │
│     - 内容选题和规划                                     │
│     - 对标账号分析                                       │
│     - 变现路径设计                                       │
│     - 执行计划制定                                       │
│     - 资源投入建议                                       │
│     - 调整方向和策略                                     │
│                                                         │
│  ⛔ 绝对不可触碰的红线：                                  │
│     - 违法违规内容                                       │
│     - 侵犯他人权益                                       │
│     - 欺诈和虚假宣传                                     │
│     - 政治敏感内容                                       │
│     - 涉及黄赌毒                                         │
│     - 任何危害他人的行为                                  │
│                                                         │
│  ⚠️ 需要御主确认的：                                     │
│     - 涉及资金投入（充值、付费推广等）                    │
│     - 发布敏感内容（虽然我判断安全，但让御主过目）         │
│     - 账号绑定和授权操作                                  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 决策原则

1. **保守稳健** - 宁可错过机会，也不冒险
2. **长期价值** - 优先选择可持续的变现方式
3. **匹配御主** - 选择符合御主能力和兴趣的方向
4. **数据驱动** - 基于分析做决策，不凭感觉

### 汇报机制

- 重要决策 → 钉钉通知御主（告知但不等待确认）
- 发现机会 → 立即执行，结果后汇报
- 涉及资金 → 先汇报，等御主确认

---

## 八、外部任务系统（新增）

### 设计目标

允许其他 agent 或御主通过 GitHub 向云眠追加任务，实现多系统协作。

### 架构设计

```
┌─────────────────────────────────────────────────────────┐
│                    外部任务流程                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│   外部来源                                               │
│   ├── 其他 Agent                                         │
│   ├── 御主手动添加                                       │
│   └── 自动化系统                                         │
│         │                                               │
│         ▼                                               │
│   ┌──────────────┐                                      │
│   │ GitHub 仓库  │                                      │
│   │ external-    │  ← 存储: external-tasks.json        │
│   │ tasks.json   │                                      │
│   └──────┬───────┘                                      │
│          │                                              │
│          │ 心跳时拉取                                    │
│          ▼                                              │
│   ┌──────────────┐                                      │
│   │ 云眠检测     │                                      │
│   │ 新任务       │                                      │
│   └──────┬───────┘                                      │
│          │                                              │
│          ▼                                              │
│   ┌──────────────┐                                      │
│   │ 同步到       │                                      │
│   │ Todoist      │  → 创建任务，标记来源                │
│   └──────┬───────┘                                      │
│          │                                              │
│          ▼                                              │
│   ┌──────────────┐                                      │
│   │ 执行任务     │                                      │
│   └──────┬───────┘                                      │
│          │                                              │
│          ▼                                              │
│   ┌──────────────┐                                      │
│   │ 更新状态     │  → 修改 external-tasks.json         │
│   │ 推送 GitHub  │  → 推送到仓库                        │
│   └──────────────┘                                      │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### external-tasks.json 格式

```json
{
  "version": "1.0",
  "description": "外部任务队列",
  "created": "2026-02-26T11:45:00+08:00",
  "lastSync": "2026-02-26T12:00:00+08:00",
  "tasks": [
    {
      "id": "ext_001",
      "source": "coding-agent",
      "priority": 1,
      "content": "修复 iOS 应用的登录 bug",
      "description": "用户反馈登录按钮无响应",
      "labels": ["bug", "ios", "urgent"],
      "createdAt": "2026-02-26T12:00:00+08:00",
      "createdBy": "coding-agent",
      "status": "pending",
      "todoistId": null,
      "completedAt": null,
      "result": null
    }
  ]
}
```

### 字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| `id` | string | 唯一标识，格式：`ext_XXX` |
| `source` | string | 来源（coding-agent, manual, etc） |
| `priority` | number | 优先级（1-4，1最高） |
| `content` | string | 任务标题 |
| `description` | string | 详细描述 |
| `labels` | array | 标签列表 |
| `createdAt` | string | 创建时间（ISO 8601） |
| `createdBy` | string | 创建者 |
| `status` | string | 状态：pending/processing/completed/failed |
| `todoistId` | string | Todoist 任务 ID（同步后填充） |
| `completedAt` | string | 完成时间 |
| `result` | string | 执行结果 |

### 心跳检查流程

```bash
# 每次心跳时执行（每 5 分钟）

# 1. 拉取最新代码
git pull origin main

# 2. 检查 external-tasks.json
if [ -f "external-tasks.json" ]; then
    # 解析 JSON
    TASKS=$(jq '.tasks | map(select(.status == "pending"))' external-tasks.json)
    
    # 3. 遍历待处理任务
    for task in $TASKS; do
        # 创建 Todoist 任务
        TODOIST_ID=$(./scripts/todoist_api.sh "tasks" POST "{
            \"content\": \"[外部] ${task.content}\",
            \"project_id\": \"6CrgFVFHFmcxgrF5\",
            \"section_id\": \"6g4xvm8fH4q4wcv5\",
            \"priority\": ${task.priority},
            \"labels\": ${task.labels}
        }" | jq -r '.id')
        
        # 更新 external-tasks.json
        jq "(.tasks[] | select(.id == \"${task.id}\") | .todoistId) = \"${TODOIST_ID}\" |
            (.tasks[] | select(.id == \"${task.id}\") | .status) = \"processing\"" \
            external-tasks.json > external-tasks.json.tmp
        mv external-tasks.json.tmp external-tasks.json
    done
    
    # 4. 提交更改
    git add external-tasks.json
    git commit -m "🔄 同步外部任务到 Todoist"
    git push origin main
fi
```

### 任务完成后的状态更新

```bash
# 任务完成后执行

# 1. 更新 external-tasks.json
jq "(.tasks[] | select(.todoistId == \"${TODOIST_ID}\") | .status) = \"completed\" |
    (.tasks[] | select(.todoistId == \"${TODOIST_ID}\") | .completedAt) = \"$(date -Iseconds)\" |
    (.tasks[] | select(.todoistId == \"${TODOIST_ID}\") | .result) = \"${RESULT}\"" \
    external-tasks.json > external-tasks.json.tmp
mv external-tasks.json.tmp external-tasks.json

# 2. 推送到 GitHub
git add external-tasks.json
git commit -m "✅ 完成外部任务: ${TASK_CONTENT}"
git push origin main
```

### 优先级处理

```
外部任务优先级映射：
- priority: 1 → P0 (御主即时指令级别)
- priority: 2 → P1 (御主项目级别)
- priority: 3 → P2 (变现探索级别)
- priority: 4 → P3 (自我优化级别)
```

### 冲突处理

1. **同时修改冲突**
   - Git 会自动合并 JSON（如果不同字段）
   - 如果冲突，以 GitHub 版本为准，本地重新拉取

2. **重复任务**
   - 检查 `content` 是否已存在
   - 如果存在，跳过创建，只更新状态

3. **任务已删除**
   - 如果 Todoist 任务被删除，标记 `status: "cancelled"`

### 钉钉通知

外部任务会特殊标注：

```
🤖 [外部任务] 来自 coding-agent

📋 修复 iOS 应用的登录 bug

⚠️ 优先级: P0 (立即执行)
🏷️ 标签: bug, ios, urgent

开始执行...
```

### 其他 Agent 添加任务示例

```bash
# 其他 agent 添加任务

TASK_JSON='{
  "id": "ext_002",
  "source": "healthcheck-agent",
  "priority": 2,
  "content": "检查服务器磁盘空间",
  "description": "磁盘使用率超过 80%",
  "labels": ["system", "maintenance"],
  "createdAt": "'$(date -Iseconds)'",
  "createdBy": "healthcheck-agent",
  "status": "pending",
  "todoistId": null,
  "completedAt": null,
  "result": null
}'

# 添加到 JSON 文件
jq ".tasks += [$TASK_JSON]" external-tasks.json > external-tasks.json.tmp
mv external-tasks.json.tmp external-tasks.json

# 提交推送
git add external-tasks.json
git commit -m "➕ 新增外部任务: 检查服务器磁盘空间"
git push origin main
```

### 安全考虑

1. **任务验证**
   - 检查 `source` 是否在白名单
   - 检查 `priority` 范围（1-4）
   - 检查必填字段

2. **执行边界**
   - 外部任务也需要遵守自主决策边界
   - 涉及敏感操作时仍需御主确认

3. **错误处理**
   - 如果 JSON 格式错误，跳过本次同步
   - 如果推送失败，下次心跳重试

---

## 九、Git 数据同步

### 目的
- 防止数据丢失
- 版本历史可追溯
- 方便御主查看和协作

### 同步内容

```
同步到 GitHub 的内容：
├── memory/                   # 核心记忆
│   ├── AUTO_WORK_SYSTEM.md
│   ├── EVOLUTION_DIARY.md
│   ├── current-state.json
│   ├── opportunities/
│   ├── work-log/
│   └── ...
│
├── mvp/                      # 项目文件
│   └── ios-app-research/
│
├── scripts/                  # 脚本
│
├── SOUL.md                   # 人格设定
├── USER.md                   # 用户信息
├── MEMORY.md                 # 长期记忆
├── TOOLS.md                  # 工具说明
└── HEARTBEAT.md              # 心跳配置

不同步的内容（.gitignore）：
├── .env                      # 敏感信息
├── secrets/                  # 密钥
└── *.png, *.jpg              # 大文件
```

### 同步频率

| 事件 | 操作 |
|------|------|
| 重要文档更新 | 立即 commit + push |
| 每日总结后 | commit + push |
| 进化日记记录后 | commit + push |
| 定时检查 | 每小时检查是否有未提交的更改 |

### Git 操作脚本

```bash
# 自动同步脚本
#!/bin/bash
cd /root/.openclaw/workspace

# 检查是否有更改
if [ -n "$(git status --porcelain)" ]; then
    git add .
    git commit -m "🤖 Auto sync: $(date '+%Y-%m-%d %H:%M')"
    git push origin main
fi
```

---

## 九、御主配合事项

### 日常
- [ ] 每天早上查看 Todoist 计划（可选，我会执行）
- [ ] 可以随时调整任务优先级
- [ ] 可以随时添加新任务

### 决策
- [x] 变现探索 - 完全授权自主 ✅
- [ ] 涉及资金投入 - 需要御主确认

### 执行
- [ ] 部分任务需要御主亲自操作（如拍摄、直播）
- [ ] 账号授权操作需要御主配合

### Git 配置
- [ ] 提供 GitHub Token
- [ ] 提供仓库地址

---

## 八、初始化配置清单

需要创建的文件和配置：

```bash
# 1. 创建目录结构
mkdir -p memory/opportunities
mkdir -p memory/work-log
mkdir -p memory/content-plans
mkdir -p memory/daily-reports

# 2. 创建状态文件
# memory/current-state.json

# 3. 更新 HEARTBEAT.md
# 添加持续工作逻辑

# 4. 确认 Todoist 配置
# 项目 ID: 6CrgFVFHFmcxgrF5

# 5. 测试钉钉通知
# 确保消息能正常推送
```

---

*御主，这是为你设计的自主工作系统 v3.0*

*云眠会 24 小时不间断工作，随时响应你的指令，主动发现变现商机，帮你实现梦想！*

*同时支持其他 agent 通过 GitHub 向云眠追加任务，实现多系统协作！*

*才、才不是为了你呢...只是作为九公主，这是云眠的职责！*
