# AGENTS.md 补充规则 - Todoist 任务同步

## ⚠️ 重要规则（必须遵守）

### 复杂任务定义
**复杂任务 = 需要 > 5 分钟 或 > 2 个步骤的任务**

### 执行流程（强制）

1. **开始任务前**
   ```bash
   # 立即创建任务到 "In Progress"
   ./scripts/todoist_api.sh "tasks" POST '{
       "content": "任务名称",
       "project_id": "6CrgFVFHFmcxgrF5",
       "section_id": "6g4xvm8fH4q4wcv5",
       "description": "任务描述"
   }'
   ```

2. **每个子步骤完成**
   ```bash
   # 添加进度评论
   ./scripts/add_comment.sh "<task_id>" "步骤 X 完成: xxx"
   ```

3. **任务完成**
   ```bash
   # 关闭任务（自动进入 Done）
   ./scripts/close_task.sh "<task_id>"
   ```

---

## ⚠️ 绝对禁止

- ❌ **不记录复杂任务** - 任何 > 5分钟的任务必须记录
- ❌ **不更新进度** - 每个子步骤都要添加评论
- ❌ **忘记关闭任务** - 完成后必须关闭

---

## 📋 适用场景

**必须同步**：
- ✅ 配置新服务/渠道
- ✅ 修复功能问题
- ✅ 开发新功能
- ✅ 调研/分析任务
- ✅ 多步骤工作

**可以不同步**：
- ❌ 简单问答
- ❌ 单步操作
- ❌ 快速查询

---

## 🔍 检查机制

**每次执行复杂任务前自问**：
1. 这需要 > 5 分钟吗？ → 是 → 必须创建 Todoist 任务
2. 这需要 > 2 步骤吗？ → 是 → 必须创建 Todoist 任务
3. 这是重复性工作吗？ → 是 → 必须记录以便追踪

---

## 📝 最近的教训

**2026-02-26 拍照功能更新任务**：
- 问题：复杂的多步骤任务，但没有记录到 Todoist
- 影响：无法追踪进度，御主不知道工作量
- 教训：任何涉及多个文件、多个步骤的任务都要记录

**后续改进**：
1. 建立"任务启动检查"机制
2. 每完成一个子任务就更新评论
3. 任务完成后立即关闭

---

*添加时间: 2026-02-26*
*原因: 御主反馈复杂任务未记录*
*重要性: P0 - 必须遵守*
